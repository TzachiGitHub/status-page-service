{"version":3,"sources":["../src/lib/prisma.ts","../src/index.ts","../src/routes/auth.ts","../src/middleware/validate.ts","../src/middleware/auth.ts","../src/lib/tokenBlacklist.ts","../src/routes/monitors.ts","../src/services/monitorService.ts","../src/middleware/pagination.ts","../src/validation/monitors.ts","../src/routes/components.ts","../src/services/componentService.ts","../src/validation/components.ts","../src/routes/componentGroups.ts","../src/services/componentGroupService.ts","../src/routes/incidents.ts","../src/services/incidentService.ts","../src/sse/manager.ts","../src/notifications/dispatcher.ts","../src/notifications/email.ts","../src/notifications/webhook.ts","../src/notifications/slack.ts","../src/notifications/templates.ts","../src/notifications/hooks.ts","../src/validation/incidents.ts","../src/routes/subscribers.ts","../src/services/subscriberService.ts","../src/validation/subscribers.ts","../src/routes/notificationChannels.ts","../src/services/notificationChannelService.ts","../src/validation/notificationChannels.ts","../src/routes/apiKeys.ts","../src/services/apiKeyService.ts","../src/validation/apiKeys.ts","../src/routes/statusPage.ts","../src/services/statusPageService.ts","../src/validation/statusPage.ts","../src/routes/public.ts","../src/sse/routes.ts","../src/routes/heartbeat.ts","../src/middleware/errorHandler.ts","../src/middleware/sanitize.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient();\n\nexport default prisma;\n","import 'dotenv/config';\nimport express from 'express';\nimport cors from 'cors';\nimport path from 'path';\nimport authRoutes from './routes/auth.js';\nimport monitorRoutes from './routes/monitors.js';\nimport componentRoutes from './routes/components.js';\nimport componentGroupRoutes from './routes/componentGroups.js';\nimport incidentRoutes from './routes/incidents.js';\nimport subscriberRoutes from './routes/subscribers.js';\nimport notificationChannelRoutes from './routes/notificationChannels.js';\nimport apiKeyRoutes from './routes/apiKeys.js';\nimport statusPageRoutes from './routes/statusPage.js';\nimport publicRoutes from './routes/public.js';\nimport sseRoutes from './sse/routes.js';\nimport { createHeartbeatRouter } from './routes/heartbeat.js';\nimport { authenticate } from './middleware/auth.js';\nimport { errorHandler } from './middleware/errorHandler.js';\nimport { sanitizeBody } from './middleware/sanitize.js';\nimport prisma from './lib/prisma.js';\n\n// __dirname available natively in CJS\n\nconst app = express();\nconst PORT = parseInt(process.env.PORT || '3030', 10);\n\nconst allowedOrigins = process.env.CORS_ORIGINS ? process.env.CORS_ORIGINS.split(',').map(s => s.trim()) : [];\napp.use(cors({\n  origin: allowedOrigins.length > 0 ? allowedOrigins : undefined,\n  credentials: true,\n}));\napp.use(express.json({ limit: '1mb' }));\napp.use(sanitizeBody);\n\n// Health check\napp.get('/api/health', (_req, res) => {\n  res.json({ status: 'ok', timestamp: new Date().toISOString() });\n});\n\n// API routes\napp.use('/api/auth', authRoutes);\napp.use('/api/monitors', authenticate, monitorRoutes);\napp.use('/api/components', authenticate, componentRoutes);\napp.use('/api/component-groups', authenticate, componentGroupRoutes);\napp.use('/api/incidents', authenticate, incidentRoutes);\napp.use('/api/subscribers', subscriberRoutes);\napp.use('/api/notification-channels', authenticate, notificationChannelRoutes);\napp.use('/api/api-keys', authenticate, apiKeyRoutes);\napp.use('/api/status-page', statusPageRoutes);\napp.use('/api/public', publicRoutes);\n\n// SSE routes\napp.use(sseRoutes);\n\n// Heartbeat endpoint (no auth â€” external services POST to it)\napp.use('/api/heartbeat', createHeartbeatRouter(prisma));\n\n// Serve public status page\napp.use('/status', express.static(path.join(__dirname, '../public/status-page')));\n// SPA fallback for status page\napp.get('/status/*', (_req, res) => {\n  const indexPath = path.join(__dirname, '../public/status-page/index.html');\n  res.sendFile(indexPath, (err) => { if (err) res.status(404).end(); });\n});\n\n// Serve dashboard (catch-all for non-API routes)\napp.use(express.static(path.join(__dirname, '../public/dashboard')));\n\n// JSON 404 handler for API routes (instead of Express default HTML)\napp.use('/api', (_req, res) => {\n  res.status(404).json({ error: 'Not found' });\n});\n\n// Error handling for service errors (NotFoundError etc.)\napp.use((err: any, _req: express.Request, res: express.Response, next: express.NextFunction) => {\n  if (err.statusCode) {\n    res.status(err.statusCode).json({ error: { code: err.code || 'ERROR', message: err.message } });\n    return;\n  }\n  next(err);\n});\n\napp.use(errorHandler);\n\n// SPA fallback for dashboard (must be after API routes and error handlers)\napp.get('*', (req, res) => {\n  if (req.path.startsWith('/api') || req.path.startsWith('/status')) {\n    res.status(404).json({ error: 'Not found' });\n    return;\n  }\n  const indexPath = path.join(__dirname, '../public/dashboard/index.html');\n  res.sendFile(indexPath, (err) => { if (err) res.status(404).end(); });\n});\n\nif (process.env.NODE_ENV !== 'test') {\n  app.listen(PORT, () => {\n    console.log(`ðŸš€ Status Page server running on http://localhost:${PORT}`);\n  });\n}\n\nexport default app;\n","import { Router, Request, Response } from 'express';\nimport bcrypt from 'bcryptjs';\nimport jwt from 'jsonwebtoken';\nimport { z } from 'zod';\nimport rateLimit from 'express-rate-limit';\nimport xss from 'xss';\nimport prisma from '../lib/prisma.js';\nimport { validate } from '../middleware/validate.js';\nimport { authenticate } from '../middleware/auth.js';\nimport { tokenBlacklist } from '../lib/tokenBlacklist.js';\n\nconst loginLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000, // 15 minutes\n  max: 10, // max 10 attempts per window\n  message: { error: 'Too many login attempts. Please try again later.' },\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\nconst registerLimiter = rateLimit({\n  windowMs: 60 * 60 * 1000, // 1 hour\n  max: 5,\n  message: { error: 'Too many registration attempts. Please try again later.' },\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\nconst router = Router();\n\nconst registerSchema = z.object({\n  orgName: z.string().min(1),\n  name: z.string().min(1),\n  email: z.string().email(),\n  password: z.string().min(8, 'Password must be at least 8 characters'),\n});\n\nconst loginSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(1),\n});\n\nfunction getJwtSecret(): string {\n  const secret = process.env.JWT_SECRET;\n  if (!secret) {\n    throw new Error('JWT_SECRET environment variable is required');\n  }\n  return secret;\n}\n\nfunction signToken(payload: { userId: string; orgId: string; role: string }): string {\n  return jwt.sign(payload, getJwtSecret(), { expiresIn: '1h' });\n}\n\nrouter.post('/register', registerLimiter, validate(registerSchema), async (req: Request, res: Response): Promise<void> => {\n  try {\n    const { orgName, name, email, password } = req.body;\n\n    const existing = await prisma.member.findUnique({ where: { email } });\n    if (existing) {\n      res.status(409).json({ error: 'Email already registered' });\n      return;\n    }\n\n    const slug = orgName.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');\n    const hashedPassword = await bcrypt.hash(password, 10);\n\n    const org = await prisma.organization.create({\n      data: {\n        name: orgName,\n        slug,\n        members: {\n          create: { email, password: hashedPassword, name, role: 'OWNER' },\n        },\n      },\n      include: { members: true },\n    });\n\n    const member = org.members[0];\n    const token = signToken({ userId: member.id, orgId: org.id, role: member.role });\n\n    res.status(201).json({\n      token,\n      user: { id: member.id, email: member.email, name: member.name, role: member.role },\n      organization: { id: org.id, name: org.name, slug: org.slug },\n    });\n  } catch (err) {\n    console.error('Registration error:', err);\n    const message = (err as any)?.code === 'P2002' ? 'Organization name already taken' : 'Registration failed';\n    res.status(500).json({ error: message });\n  }\n});\n\nrouter.post('/login', loginLimiter, validate(loginSchema), async (req: Request, res: Response): Promise<void> => {\n  try {\n    const { email, password } = req.body;\n\n    const member = await prisma.member.findUnique({ where: { email }, include: { organization: true } });\n    if (!member) {\n      res.status(401).json({ error: 'Invalid credentials' });\n      return;\n    }\n\n    const valid = await bcrypt.compare(password, member.password);\n    if (!valid) {\n      res.status(401).json({ error: 'Invalid credentials' });\n      return;\n    }\n\n    const token = signToken({ userId: member.id, orgId: member.orgId, role: member.role });\n\n    res.json({\n      token,\n      user: { id: member.id, email: member.email, name: member.name, role: member.role },\n      organization: { id: member.organization.id, name: member.organization.name, slug: member.organization.slug },\n    });\n  } catch (err) {\n    console.error('Login error:', err);\n    res.status(500).json({ error: 'Login failed' });\n  }\n});\n\nrouter.get('/me', authenticate, async (req: Request, res: Response): Promise<void> => {\n  try {\n    const member = await prisma.member.findUnique({\n      where: { id: req.user!.userId },\n      include: { organization: true },\n    });\n    if (!member) {\n      res.status(404).json({ error: 'User not found' });\n      return;\n    }\n\n    res.json({\n      user: { id: member.id, email: member.email, name: member.name, role: member.role },\n      organization: { id: member.organization.id, name: member.organization.name, slug: member.organization.slug },\n    });\n  } catch (err) {\n    console.error('Fetch user error:', err);\n    res.status(500).json({ error: 'Failed to fetch user' });\n  }\n});\n\nrouter.post('/logout', authenticate, (req: Request, res: Response) => {\n  const token = req.headers.authorization?.slice(7);\n  if (token) {\n    tokenBlacklist.add(token);\n  }\n  res.json({ message: 'Logged out successfully' });\n});\n\nexport default router;\n","import { Request, Response, NextFunction } from 'express';\nimport { ZodSchema, ZodError } from 'zod';\n\nexport function validate(schema: ZodSchema) {\n  return (req: Request, res: Response, next: NextFunction): void => {\n    try {\n      req.body = schema.parse(req.body);\n      next();\n    } catch (err) {\n      if (err instanceof ZodError) {\n        res.status(400).json({\n          error: 'Validation failed',\n          details: err.errors.map(e => ({ path: e.path.join('.'), message: e.message })),\n        });\n        return;\n      }\n      next(err);\n    }\n  };\n}\n","import { Request, Response, NextFunction } from 'express';\nimport jwt from 'jsonwebtoken';\nimport { tokenBlacklist } from '../lib/tokenBlacklist.js';\n\nexport interface AuthPayload {\n  userId: string;\n  orgId: string;\n  role: string;\n}\n\ndeclare global {\n  namespace Express {\n    interface Request {\n      user?: AuthPayload;\n    }\n  }\n}\n\nconst ROLE_HIERARCHY: Record<string, number> = {\n  VIEWER: 0,\n  EDITOR: 1,\n  ADMIN: 2,\n  OWNER: 3,\n};\n\nexport function requireRole(...allowedRoles: string[]) {\n  return (req: Request, res: Response, next: NextFunction): void => {\n    if (!req.user) {\n      res.status(401).json({ error: 'Authentication required' });\n      return;\n    }\n    if (!allowedRoles.includes(req.user.role)) {\n      res.status(403).json({ error: 'Insufficient permissions' });\n      return;\n    }\n    next();\n  };\n}\n\nexport function requireMinRole(minRole: string) {\n  return (req: Request, res: Response, next: NextFunction): void => {\n    if (!req.user) {\n      res.status(401).json({ error: 'Authentication required' });\n      return;\n    }\n    const userLevel = ROLE_HIERARCHY[req.user.role] ?? -1;\n    const requiredLevel = ROLE_HIERARCHY[minRole] ?? 999;\n    if (userLevel < requiredLevel) {\n      res.status(403).json({ error: 'Insufficient permissions' });\n      return;\n    }\n    next();\n  };\n}\n\nexport function authenticate(req: Request, res: Response, next: NextFunction): void {\n  const header = req.headers.authorization;\n  if (!header?.startsWith('Bearer ')) {\n    res.status(401).json({ error: 'Missing or invalid authorization header' });\n    return;\n  }\n\n  const token = header.slice(7);\n  try {\n    // Check token blacklist (BUG-006)\n    if (tokenBlacklist.has(token)) {\n      res.status(401).json({ error: 'Token has been revoked' });\n      return;\n    }\n    const secret = process.env.JWT_SECRET;\n    if (!secret) {\n      res.status(500).json({ error: 'Server configuration error' });\n      return;\n    }\n    const payload = jwt.verify(token, secret) as AuthPayload;\n    req.user = payload;\n    next();\n  } catch {\n    res.status(401).json({ error: 'Invalid or expired token' });\n  }\n}\n","// In-memory token blacklist. Use Redis in production for persistence across restarts.\nexport const tokenBlacklist = new Set<string>();\n","import { Router, Request, Response, NextFunction } from 'express';\nimport * as monitorService from '../services/monitorService.js';\nimport { validate } from '../middleware/validate.js';\nimport { requireMinRole } from '../middleware/auth.js';\nimport { validatePagination } from '../middleware/pagination.js';\nimport { CreateMonitorSchema, UpdateMonitorSchema } from '../validation/monitors.js';\n\nconst router = Router();\n\nfunction asyncHandler(fn: (req: Request, res: Response) => Promise<void>) {\n  return (req: Request, res: Response, next: NextFunction) => fn(req, res).catch(next);\n}\n\nrouter.get('/', validatePagination, asyncHandler(async (req, res) => {\n  const { page, limit, status, type } = req.query;\n  const result = await monitorService.list(req.user!.orgId, {\n    page: page ? Number(page) : undefined,\n    limit: limit ? Number(limit) : undefined,\n    status: status as string,\n    type: type as string,\n  });\n  res.json(result);\n}));\n\nrouter.get('/:id', asyncHandler(async (req, res) => {\n  const result = await monitorService.getById(req.params.id, req.user!.orgId);\n  res.json(result);\n}));\n\nrouter.post('/', requireMinRole('EDITOR'), validate(CreateMonitorSchema), asyncHandler(async (req, res) => {\n  const result = await monitorService.create(req.body, req.user!.orgId);\n  res.status(201).json(result);\n}));\n\nrouter.patch('/:id', requireMinRole('EDITOR'), validate(UpdateMonitorSchema), asyncHandler(async (req, res) => {\n  const result = await monitorService.update(req.params.id, req.body, req.user!.orgId);\n  res.json(result);\n}));\n\nrouter.delete('/:id', requireMinRole('ADMIN'), asyncHandler(async (req, res) => {\n  const result = await monitorService.remove(req.params.id, req.user!.orgId);\n  res.json(result);\n}));\n\nrouter.post('/:id/pause', requireMinRole('EDITOR'), asyncHandler(async (req, res) => {\n  const result = await monitorService.pause(req.params.id, req.user!.orgId);\n  res.json(result);\n}));\n\nrouter.post('/:id/resume', requireMinRole('EDITOR'), asyncHandler(async (req, res) => {\n  const result = await monitorService.resume(req.params.id, req.user!.orgId);\n  res.json(result);\n}));\n\nrouter.get('/:id/checks', asyncHandler(async (req, res) => {\n  const { page, limit } = req.query;\n  const result = await monitorService.getChecks(req.params.id, req.user!.orgId, {\n    page: page ? Number(page) : undefined,\n    limit: limit ? Number(limit) : undefined,\n  });\n  res.json(result);\n}));\n\nrouter.get('/:id/uptime', asyncHandler(async (req, res) => {\n  const result = await monitorService.getUptimeStats(req.params.id);\n  res.json(result);\n}));\n\nrouter.get('/:id/response-times', asyncHandler(async (req, res) => {\n  const result = await monitorService.getResponseTimes(req.params.id, req.query.range as string);\n  res.json(result);\n}));\n\nexport default router;\n","import prisma from '../lib/prisma.js';\nimport { MonitorStatus } from '@prisma/client';\n\nconst VALID_MONITOR_STATUSES = ['UP', 'DOWN', 'DEGRADED', 'UNKNOWN'];\nconst VALID_MONITOR_TYPES = ['HTTP', 'TCP', 'PING', 'DNS', 'SSL', 'HEARTBEAT'];\n\nfunction validatePagination(page?: number, limit?: number): { page: number; limit: number } {\n  let p = page || 1;\n  let l = limit || 20;\n  if (isNaN(p) || p < 1) p = 1;\n  if (isNaN(l) || l < 1) l = 1;\n  if (l > 100) l = 100;\n  return { page: p, limit: l };\n}\n\nexport async function list(orgId: string, filters: { page?: number; limit?: number; status?: string; type?: string } = {}) {\n  const { page, limit } = validatePagination(filters.page, filters.limit);\n  const where: any = { orgId };\n  if (filters.status) {\n    if (!VALID_MONITOR_STATUSES.includes(filters.status)) {\n      throw Object.assign(new Error(`Invalid status filter. Must be one of: ${VALID_MONITOR_STATUSES.join(', ')}`), { statusCode: 400, code: 'INVALID_FILTER' });\n    }\n    where.status = filters.status;\n  }\n  if (filters.type) {\n    if (!VALID_MONITOR_TYPES.includes(filters.type)) {\n      throw Object.assign(new Error(`Invalid type filter. Must be one of: ${VALID_MONITOR_TYPES.join(', ')}`), { statusCode: 400, code: 'INVALID_FILTER' });\n    }\n    where.type = filters.type;\n  }\n\n  const [monitors, total] = await Promise.all([\n    prisma.monitor.findMany({ where, skip: (page - 1) * limit, take: limit, orderBy: { createdAt: 'desc' }, include: { component: true } }),\n    prisma.monitor.count({ where }),\n  ]);\n  return { data: monitors, meta: { total, page, limit } };\n}\n\nexport async function getById(id: string, orgId: string) {\n  const monitor = await prisma.monitor.findFirst({ where: { id, orgId }, include: { component: true } });\n  if (!monitor) throw new NotFoundError('Monitor not found');\n  return { data: monitor };\n}\n\nexport async function create(data: any, orgId: string) {\n  // BUG-017: Auto-generate heartbeatToken for HEARTBEAT monitors\n  if (data.type === 'HEARTBEAT' && !data.heartbeatToken) {\n    const { randomUUID } = await import('crypto');\n    data.heartbeatToken = randomUUID();\n  }\n  const monitor = await prisma.monitor.create({ data: { ...data, orgId } });\n  return { data: monitor };\n}\n\nexport async function update(id: string, data: any, orgId: string) {\n  await ensureExists(id, orgId);\n  const monitor = await prisma.monitor.update({ where: { id }, data });\n  return { data: monitor };\n}\n\nexport async function remove(id: string, orgId: string) {\n  await ensureExists(id, orgId);\n  await prisma.monitor.delete({ where: { id } });\n  return { data: { id } };\n}\n\nexport async function pause(id: string, orgId: string) {\n  await ensureExists(id, orgId);\n  const monitor = await prisma.monitor.update({ where: { id }, data: { enabled: false } });\n  return { data: monitor };\n}\n\nexport async function resume(id: string, orgId: string) {\n  await ensureExists(id, orgId);\n  const monitor = await prisma.monitor.update({ where: { id }, data: { enabled: true } });\n  return { data: monitor };\n}\n\nexport async function getChecks(id: string, orgId: string, pagination: { page?: number; limit?: number } = {}) {\n  await ensureExists(id, orgId);\n  const { page, limit } = validatePagination(pagination.page, pagination.limit);\n  const [checks, total] = await Promise.all([\n    prisma.monitorCheck.findMany({ where: { monitorId: id }, skip: (page - 1) * limit, take: limit, orderBy: { checkedAt: 'desc' } }),\n    prisma.monitorCheck.count({ where: { monitorId: id } }),\n  ]);\n  return { data: checks, meta: { total, page, limit } };\n}\n\nexport async function getUptimeStats(id: string) {\n  const ranges = { '24h': 1, '7d': 7, '30d': 30, '90d': 90 };\n  const stats: Record<string, number> = {};\n  for (const [key, days] of Object.entries(ranges)) {\n    const since = new Date(Date.now() - days * 86400000);\n    const [total, up] = await Promise.all([\n      prisma.monitorCheck.count({ where: { monitorId: id, checkedAt: { gte: since } } }),\n      prisma.monitorCheck.count({ where: { monitorId: id, checkedAt: { gte: since }, status: MonitorStatus.UP } }),\n    ]);\n    stats[key] = total > 0 ? Math.round((up / total) * 10000) / 100 : 100;\n  }\n  return { data: stats };\n}\n\nexport async function getResponseTimes(id: string, range: string = '24h') {\n  const days = range === '7d' ? 7 : range === '30d' ? 30 : 1;\n  const since = new Date(Date.now() - days * 86400000);\n  const checks = await prisma.monitorCheck.findMany({\n    where: { monitorId: id, checkedAt: { gte: since }, responseTime: { not: null } },\n    select: { checkedAt: true, responseTime: true },\n    orderBy: { checkedAt: 'asc' },\n  });\n  return { data: checks };\n}\n\nclass NotFoundError extends Error {\n  statusCode = 404;\n  code = 'RESOURCE_NOT_FOUND';\n}\n\nasync function ensureExists(id: string, orgId: string) {\n  const m = await prisma.monitor.findFirst({ where: { id, orgId } });\n  if (!m) throw new NotFoundError('Monitor not found');\n  return m;\n}\n\nexport { NotFoundError };\n","import { Request, Response, NextFunction } from 'express';\n\nexport function validatePagination(req: Request, res: Response, next: NextFunction): void {\n  const { page, limit } = req.query;\n\n  if (page !== undefined) {\n    const p = Number(page);\n    if (!Number.isInteger(p) || p < 1) {\n      res.status(400).json({ error: 'page must be a positive integer' });\n      return;\n    }\n  }\n\n  if (limit !== undefined) {\n    const l = Number(limit);\n    if (!Number.isInteger(l) || l < 1 || l > 100) {\n      res.status(400).json({ error: 'limit must be an integer between 1 and 100' });\n      return;\n    }\n  }\n\n  next();\n}\n","import { z } from 'zod';\n\nconst BaseMonitorSchema = z.object({\n  name: z.string().min(1).max(255),\n  type: z.enum(['HTTP', 'TCP', 'PING', 'DNS', 'SSL', 'HEARTBEAT']),\n  url: z.string().url().optional(),\n  method: z.enum(['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'HEAD', 'OPTIONS']).optional(),\n  interval: z.number().int().min(10).max(3600).optional(),\n  timeout: z.number().int().min(1).max(120).optional(),\n  componentId: z.string().uuid().optional().nullable(),\n  headers: z.record(z.string(), z.string()).optional(),\n  body: z.string().optional(),\n  expectedStatus: z.number().int().optional(),\n  host: z.string().optional(),\n  port: z.number().int().min(1).max(65535).optional(),\n  config: z.record(z.string(), z.unknown()).optional(),\n  regions: z.array(z.string()).optional(),\n  alertAfter: z.number().int().min(1).optional(),\n  recoverAfter: z.number().int().min(1).optional(),\n});\n\nexport const CreateMonitorSchema = BaseMonitorSchema.superRefine((data, ctx) => {\n  if (data.type === 'HTTP' && !data.url) {\n    ctx.addIssue({ code: z.ZodIssueCode.custom, message: 'URL is required for HTTP monitors', path: ['url'] });\n  }\n  if (data.type === 'TCP') {\n    if (!data.host) ctx.addIssue({ code: z.ZodIssueCode.custom, message: 'Host is required for TCP monitors', path: ['host'] });\n    if (!data.port) ctx.addIssue({ code: z.ZodIssueCode.custom, message: 'Port is required for TCP monitors', path: ['port'] });\n  }\n  if (data.type === 'PING' && !data.host) {\n    ctx.addIssue({ code: z.ZodIssueCode.custom, message: 'Host is required for PING monitors', path: ['host'] });\n  }\n  if (data.type === 'DNS' && !data.host) {\n    ctx.addIssue({ code: z.ZodIssueCode.custom, message: 'Host is required for DNS monitors', path: ['host'] });\n  }\n  if (data.type === 'SSL' && !data.host) {\n    ctx.addIssue({ code: z.ZodIssueCode.custom, message: 'Host is required for SSL monitors', path: ['host'] });\n  }\n});\n\n// Type cannot be changed via update to prevent inconsistent state\nexport const UpdateMonitorSchema = BaseMonitorSchema.omit({ type: true }).partial();\n","import { Router, Request, Response, NextFunction } from 'express';\nimport * as componentService from '../services/componentService.js';\nimport { validate } from '../middleware/validate.js';\nimport { requireMinRole } from '../middleware/auth.js';\nimport { CreateComponentSchema, UpdateComponentSchema, ReorderComponentsSchema } from '../validation/components.js';\n\nconst router = Router();\n\nfunction asyncHandler(fn: (req: Request, res: Response) => Promise<void>) {\n  return (req: Request, res: Response, next: NextFunction) => fn(req, res).catch(next);\n}\n\nrouter.get('/', asyncHandler(async (req, res) => {\n  const result = await componentService.list(req.user!.orgId);\n  res.json(result);\n}));\n\nrouter.get('/:id', asyncHandler(async (req, res) => {\n  const result = await componentService.getById(req.params.id, req.user!.orgId);\n  res.json(result);\n}));\n\nrouter.post('/', requireMinRole('EDITOR'), validate(CreateComponentSchema), asyncHandler(async (req, res) => {\n  const result = await componentService.create(req.body, req.user!.orgId);\n  res.status(201).json(result);\n}));\n\nrouter.patch('/:id', requireMinRole('EDITOR'), validate(UpdateComponentSchema), asyncHandler(async (req, res) => {\n  const result = await componentService.update(req.params.id, req.body, req.user!.orgId);\n  res.json(result);\n}));\n\nrouter.delete('/:id', requireMinRole('ADMIN'), asyncHandler(async (req, res) => {\n  const result = await componentService.remove(req.params.id, req.user!.orgId);\n  res.json(result);\n}));\n\nrouter.post('/reorder', requireMinRole('EDITOR'), validate(ReorderComponentsSchema), asyncHandler(async (req, res) => {\n  const result = await componentService.reorder(req.body.ids, req.user!.orgId);\n  res.json(result);\n}));\n\nrouter.get('/:id/history', asyncHandler(async (req, res) => {\n  let days = req.query.days ? Number(req.query.days) : 30;\n  if (isNaN(days) || days < 1) days = 1;\n  if (days > 365) days = 365;\n  const result = await componentService.getStatusHistory(req.params.id, days);\n  res.json(result);\n}));\n\nexport default router;\n","import prisma from '../lib/prisma.js';\n\nclass NotFoundError extends Error {\n  statusCode = 404;\n  code = 'RESOURCE_NOT_FOUND';\n}\n\nexport async function list(orgId: string) {\n  const components = await prisma.component.findMany({\n    where: { orgId },\n    orderBy: { order: 'asc' },\n    include: { group: true },\n  });\n  return { data: components };\n}\n\nexport async function create(data: any, orgId: string) {\n  const existing = await prisma.component.findFirst({ where: { orgId, name: data.name } });\n  if (existing) {\n    const err = new Error('A component with this name already exists in your organization') as Error & { statusCode: number; code: string };\n    err.statusCode = 409;\n    err.code = 'DUPLICATE_NAME';\n    throw err;\n  }\n  const component = await prisma.component.create({ data: { ...data, orgId } });\n  return { data: component };\n}\n\nexport async function getById(id: string, orgId: string) {\n  const c = await prisma.component.findFirst({ where: { id, orgId }, include: { group: true } });\n  if (!c) throw new NotFoundError('Component not found');\n  return { data: c };\n}\n\nexport async function update(id: string, data: any, orgId: string) {\n  const c = await prisma.component.findFirst({ where: { id, orgId } });\n  if (!c) throw new NotFoundError('Component not found');\n  const component = await prisma.component.update({ where: { id }, data });\n  return { data: component };\n}\n\nexport async function remove(id: string, orgId: string) {\n  const c = await prisma.component.findFirst({ where: { id, orgId } });\n  if (!c) throw new NotFoundError('Component not found');\n  await prisma.component.delete({ where: { id } });\n  return { data: { id } };\n}\n\nexport async function reorder(ids: string[], orgId: string) {\n  // Validate all IDs exist in this org\n  const existing = await prisma.component.findMany({ where: { id: { in: ids }, orgId }, select: { id: true } });\n  const existingIds = new Set(existing.map((c: { id: string }) => c.id));\n  const missing = ids.filter((id) => !existingIds.has(id));\n  if (missing.length > 0) {\n    const err = new Error(`Components not found: ${missing.join(', ')}`) as Error & { statusCode: number; code: string };\n    err.statusCode = 400;\n    err.code = 'INVALID_IDS';\n    throw err;\n  }\n  const updates = ids.map((id, index) =>\n    prisma.component.updateMany({ where: { id, orgId }, data: { order: index } })\n  );\n  await prisma.$transaction(updates);\n  return { data: { success: true } };\n}\n\nexport async function getStatusHistory(id: string, days: number = 30) {\n  const since = new Date(Date.now() - days * 86400000);\n  const history = await prisma.incidentComponent.findMany({\n    where: { componentId: id, incident: { createdAt: { gte: since } } },\n    include: { incident: { select: { title: true, createdAt: true, resolvedAt: true, status: true } } },\n    orderBy: { incident: { createdAt: 'desc' } },\n  });\n  return { data: history };\n}\n","import { z } from 'zod';\n\nexport const CreateComponentSchema = z.object({\n  name: z.string().min(1).max(255),\n  description: z.string().optional(),\n  status: z.enum(['OPERATIONAL', 'DEGRADED_PERFORMANCE', 'PARTIAL_OUTAGE', 'MAJOR_OUTAGE', 'UNDER_MAINTENANCE']).optional(),\n  groupId: z.string().uuid().optional().nullable(),\n  order: z.number().int().min(0).optional(),\n  showOnStatusPage: z.boolean().optional(),\n});\n\nexport const UpdateComponentSchema = CreateComponentSchema.partial();\n\nexport const ReorderComponentsSchema = z.object({\n  ids: z.array(z.string().uuid()).min(1),\n});\n\nexport const CreateComponentGroupSchema = z.object({\n  name: z.string().min(1).max(255),\n  order: z.number().int().min(0).optional(),\n});\n\nexport const UpdateComponentGroupSchema = CreateComponentGroupSchema.partial();\n","import { Router, Request, Response, NextFunction } from 'express';\nimport * as groupService from '../services/componentGroupService.js';\nimport { validate } from '../middleware/validate.js';\nimport { CreateComponentGroupSchema, UpdateComponentGroupSchema } from '../validation/components.js';\n\nconst router = Router();\n\nfunction asyncHandler(fn: (req: Request, res: Response) => Promise<void>) {\n  return (req: Request, res: Response, next: NextFunction) => fn(req, res).catch(next);\n}\n\nrouter.get('/', asyncHandler(async (req, res) => {\n  const result = await groupService.list(req.user!.orgId);\n  res.json(result);\n}));\n\nrouter.get('/:id', asyncHandler(async (req, res) => {\n  const result = await groupService.getById(req.params.id, req.user!.orgId);\n  res.json(result);\n}));\n\nrouter.post('/', validate(CreateComponentGroupSchema), asyncHandler(async (req, res) => {\n  const result = await groupService.create(req.body, req.user!.orgId);\n  res.status(201).json(result);\n}));\n\nrouter.patch('/:id', validate(UpdateComponentGroupSchema), asyncHandler(async (req, res) => {\n  const result = await groupService.update(req.params.id, req.body, req.user!.orgId);\n  res.json(result);\n}));\n\nrouter.delete('/:id', asyncHandler(async (req, res) => {\n  const result = await groupService.remove(req.params.id, req.user!.orgId);\n  res.json(result);\n}));\n\nexport default router;\n","import prisma from '../lib/prisma.js';\n\nclass NotFoundError extends Error {\n  statusCode = 404;\n  code = 'RESOURCE_NOT_FOUND';\n}\n\nexport async function list(orgId: string) {\n  const groups = await prisma.componentGroup.findMany({\n    where: { orgId },\n    orderBy: { order: 'asc' },\n    include: { components: { orderBy: { order: 'asc' } } },\n  });\n  return { data: groups };\n}\n\nexport async function create(data: any, orgId: string) {\n  const group = await prisma.componentGroup.create({ data: { ...data, orgId } });\n  return { data: group };\n}\n\nexport async function getById(id: string, orgId: string) {\n  const g = await prisma.componentGroup.findFirst({ where: { id, orgId }, include: { components: true } });\n  if (!g) throw new NotFoundError('Component group not found');\n  return { data: g };\n}\n\nexport async function update(id: string, data: any, orgId: string) {\n  const g = await prisma.componentGroup.findFirst({ where: { id, orgId } });\n  if (!g) throw new NotFoundError('Component group not found');\n  const group = await prisma.componentGroup.update({ where: { id }, data });\n  return { data: group };\n}\n\nexport async function remove(id: string, orgId: string) {\n  const g = await prisma.componentGroup.findFirst({ where: { id, orgId } });\n  if (!g) throw new NotFoundError('Component group not found');\n  await prisma.componentGroup.delete({ where: { id } });\n  return { data: { id } };\n}\n","import { Router, Request, Response, NextFunction } from 'express';\nimport * as incidentService from '../services/incidentService.js';\nimport { validate } from '../middleware/validate.js';\nimport { requireMinRole } from '../middleware/auth.js';\nimport { validatePagination } from '../middleware/pagination.js';\nimport { CreateIncidentSchema, UpdateIncidentSchema, AddIncidentUpdateSchema } from '../validation/incidents.js';\n\nconst router = Router();\n\nfunction asyncHandler(fn: (req: Request, res: Response) => Promise<void>) {\n  return (req: Request, res: Response, next: NextFunction) => fn(req, res).catch(next);\n}\n\nrouter.get('/', validatePagination, asyncHandler(async (req, res) => {\n  const { page, limit, status } = req.query;\n  const result = await incidentService.list(req.user!.orgId, {\n    page: page ? Number(page) : undefined,\n    limit: limit ? Number(limit) : undefined,\n    status: status as string,\n  });\n  res.json(result);\n}));\n\nrouter.get('/:id', asyncHandler(async (req, res) => {\n  const result = await incidentService.getById(req.params.id, req.user!.orgId);\n  res.json(result);\n}));\n\nrouter.post('/', requireMinRole('EDITOR'), validate(CreateIncidentSchema), asyncHandler(async (req, res) => {\n  const result = await incidentService.create(req.body, req.user!.orgId);\n  res.status(201).json(result);\n}));\n\nrouter.patch('/:id', validate(UpdateIncidentSchema), asyncHandler(async (req, res) => {\n  const result = await incidentService.update(req.params.id, req.body, req.user!.orgId);\n  res.json(result);\n}));\n\nrouter.delete('/:id', requireMinRole('ADMIN'), asyncHandler(async (req, res) => {\n  const result = await incidentService.remove(req.params.id, req.user!.orgId);\n  res.json(result);\n}));\n\nrouter.post('/:id/updates', validate(AddIncidentUpdateSchema), asyncHandler(async (req, res) => {\n  const result = await incidentService.addUpdate(req.params.id, req.body, req.user!.orgId);\n  res.status(201).json(result);\n}));\n\nexport default router;\n","import prisma from '../lib/prisma.js';\nimport { IncidentStatus } from '@prisma/client';\nimport { onIncidentChange } from '../notifications/hooks.js';\n\nclass NotFoundError extends Error {\n  statusCode = 404;\n  code = 'RESOURCE_NOT_FOUND';\n}\n\nconst VALID_INCIDENT_STATUSES = ['INVESTIGATING', 'IDENTIFIED', 'MONITORING', 'RESOLVED'];\n\nfunction validatePagination(page?: number, limit?: number): { page: number; limit: number } {\n  let p = page || 1;\n  let l = limit || 20;\n  if (isNaN(p) || p < 1) p = 1;\n  if (isNaN(l) || l < 1) l = 1;\n  if (l > 100) l = 100;\n  return { page: p, limit: l };\n}\n\nexport async function list(orgId: string, filters: { page?: number; limit?: number; status?: string } = {}) {\n  const { page, limit } = validatePagination(filters.page, filters.limit);\n  const where: any = { orgId };\n  if (filters.status) {\n    if (!VALID_INCIDENT_STATUSES.includes(filters.status)) {\n      throw Object.assign(new Error(`Invalid status filter. Must be one of: ${VALID_INCIDENT_STATUSES.join(', ')}`), { statusCode: 400, code: 'INVALID_FILTER' });\n    }\n    where.status = filters.status;\n  }\n\n  const [incidents, total] = await Promise.all([\n    prisma.incident.findMany({\n      where, skip: (page - 1) * limit, take: limit,\n      orderBy: { createdAt: 'desc' },\n      include: { updates: { orderBy: { createdAt: 'desc' }, take: 1 }, components: { include: { component: true } } },\n    }),\n    prisma.incident.count({ where }),\n  ]);\n  return { data: incidents, meta: { total, page, limit } };\n}\n\nexport async function getById(id: string, orgId: string) {\n  const incident = await prisma.incident.findFirst({\n    where: { id, orgId },\n    include: { updates: { orderBy: { createdAt: 'desc' } }, components: { include: { component: true } } },\n  });\n  if (!incident) throw new NotFoundError('Incident not found');\n  return { data: incident };\n}\n\nexport async function create(data: { title: string; status?: string; severity?: string; message: string; componentIds?: string[]; componentStatus?: string }, orgId: string) {\n  const { componentIds, componentStatus, message, ...incidentData } = data;\n  const resolvedAt = incidentData.status === 'RESOLVED' ? new Date() : undefined;\n  const incident = await prisma.incident.create({\n    data: {\n      ...incidentData as any,\n      orgId,\n      ...(resolvedAt ? { resolvedAt } : {}),\n      updates: { create: { status: (incidentData.status as IncidentStatus) || 'INVESTIGATING', message } },\n      ...(componentIds?.length ? {\n        components: {\n          create: componentIds.map(componentId => ({\n            componentId,\n            status: (componentStatus as any) || 'MAJOR_OUTAGE',\n          })),\n        },\n      } : {}),\n    },\n    include: { updates: true, components: { include: { component: true } } },\n  });\n  // BUG-015: Sync component status when incident is created\n  if (componentIds?.length) {\n    const status = (componentStatus as any) || 'MAJOR_OUTAGE';\n    await prisma.component.updateMany({\n      where: { id: { in: componentIds } },\n      data: { status },\n    });\n  }\n  onIncidentChange(orgId, incident).catch(() => {});\n  return { data: incident };\n}\n\nexport async function update(id: string, data: any, orgId: string) {\n  const existing = await prisma.incident.findFirst({ where: { id, orgId } });\n  if (!existing) throw new NotFoundError('Incident not found');\n  const resolvedAt = data.status === 'RESOLVED' ? new Date() : undefined;\n  const incident = await prisma.incident.update({ where: { id }, data: { ...data, ...(resolvedAt ? { resolvedAt } : {}) } });\n  return { data: incident };\n}\n\nexport async function remove(id: string, orgId: string) {\n  const existing = await prisma.incident.findFirst({ where: { id, orgId } });\n  if (!existing) throw new NotFoundError('Incident not found');\n  await prisma.incident.delete({ where: { id } });\n  return { data: { id } };\n}\n\nexport async function addUpdate(incidentId: string, data: { status: string; message: string }, orgId: string) {\n  const incident = await prisma.incident.findFirst({ where: { id: incidentId, orgId } });\n  if (!incident) throw new NotFoundError('Incident not found');\n  const resolvedAt = data.status === 'RESOLVED' ? new Date() : null;\n  const [incidentUpdate] = await prisma.$transaction([\n    prisma.incidentUpdate.create({ data: { incidentId, status: data.status as IncidentStatus, message: data.message } }),\n    prisma.incident.update({ where: { id: incidentId }, data: { status: data.status as IncidentStatus, resolvedAt } }),\n  ]);\n  // BUG-015: Restore component status to OPERATIONAL when incident is resolved\n  if (data.status === 'RESOLVED') {\n    const incidentComponents = await prisma.incidentComponent.findMany({\n      where: { incidentId },\n      select: { componentId: true },\n    });\n    if (incidentComponents.length > 0) {\n      await prisma.component.updateMany({\n        where: { id: { in: incidentComponents.map(ic => ic.componentId) } },\n        data: { status: 'OPERATIONAL' },\n      });\n    }\n  }\n  onIncidentChange(orgId, { id: incidentId, status: data.status }, incidentUpdate).catch(() => {});\n  return { data: incidentUpdate };\n}\n\nexport async function createScheduledMaintenance(\n  data: { title: string; message: string; componentIds?: string[]; scheduledStartAt?: string; scheduledEndAt?: string },\n  orgId: string\n) {\n  const { scheduledStartAt, scheduledEndAt, ...rest } = data;\n  const result = await create({ ...rest, status: 'MONITORING', severity: 'MINOR' }, orgId);\n  // Update with maintenance-specific fields\n  if (scheduledStartAt || scheduledEndAt) {\n    await prisma.incident.update({\n      where: { id: result.data.id },\n      data: {\n        isMaintenance: true,\n        ...(scheduledStartAt ? { scheduledStartAt: new Date(scheduledStartAt) } : {}),\n        ...(scheduledEndAt ? { scheduledEndAt: new Date(scheduledEndAt) } : {}),\n      },\n    });\n  } else {\n    await prisma.incident.update({\n      where: { id: result.data.id },\n      data: { isMaintenance: true },\n    });\n  }\n  return result;\n}\n","import type { Response } from 'express';\n\nexport interface SSEEvent {\n  type: string;\n  data: any;\n}\n\ntype ConnectionType = 'dashboard' | 'public';\n\nfunction key(orgId: string, type: ConnectionType): string {\n  return `${orgId}:${type}`;\n}\n\nexport class SSEManager {\n  private connections = new Map<string, Set<Response>>();\n\n  addConnection(orgId: string, type: ConnectionType, res: Response): void {\n    const k = key(orgId, type);\n    if (!this.connections.has(k)) {\n      this.connections.set(k, new Set());\n    }\n    this.connections.get(k)!.add(res);\n  }\n\n  removeConnection(orgId: string, type: ConnectionType, res: Response): void {\n    const k = key(orgId, type);\n    const set = this.connections.get(k);\n    if (set) {\n      set.delete(res);\n      if (set.size === 0) this.connections.delete(k);\n    }\n  }\n\n  broadcast(orgId: string, type: ConnectionType, event: SSEEvent): void {\n    const k = key(orgId, type);\n    const set = this.connections.get(k);\n    if (!set) return;\n    const payload = `event: ${event.type}\\ndata: ${JSON.stringify(event.data)}\\n\\n`;\n    for (const res of set) {\n      try {\n        res.write(payload);\n      } catch {\n        set.delete(res);\n      }\n    }\n  }\n\n  broadcastAll(orgId: string, event: SSEEvent): void {\n    this.broadcast(orgId, 'dashboard', event);\n    this.broadcast(orgId, 'public', event);\n  }\n\n  getConnectionCount(orgId: string): number {\n    let count = 0;\n    for (const type of ['dashboard', 'public'] as ConnectionType[]) {\n      const set = this.connections.get(key(orgId, type));\n      if (set) count += set.size;\n    }\n    return count;\n  }\n}\n\nexport const sseManager = new SSEManager();\n","import prisma from '../lib/prisma.js';\nimport { sendEmail } from './email.js';\nimport { sendWebhook, type WebhookPayload } from './webhook.js';\nimport { sendSlack, formatMonitorAlert, formatIncidentUpdate } from './slack.js';\nimport * as templates from './templates.js';\n\nexport interface NotificationEvent {\n  type: 'monitor.down' | 'monitor.recovery' | 'incident.created' | 'incident.updated';\n  data: any;\n}\n\nfunction delay(ms: number): Promise<void> {\n  return new Promise((r) => setTimeout(r, ms));\n}\n\nasync function dispatchToChannel(\n  channel: { type: string; config: any },\n  event: NotificationEvent,\n): Promise<boolean> {\n  const { type, data } = event;\n\n  switch (channel.type) {\n    case 'EMAIL': {\n      const emailAddr = (channel.config as any).email;\n      if (!emailAddr) return false;\n      let tpl: { subject: string; html: string; text: string };\n      if (type === 'monitor.down') {\n        tpl = templates.monitorDownAlert(data.monitor, data.check?.message || 'Unknown error', new Date().toISOString());\n      } else if (type === 'monitor.recovery') {\n        tpl = templates.monitorRecoveryAlert(data.monitor, data.alert?.duration || 'unknown');\n      } else if (type === 'incident.created') {\n        tpl = templates.incidentCreated(data.incident, [], data.update?.message || '');\n      } else {\n        tpl = templates.incidentUpdated(data.incident, data.update?.message || '');\n      }\n      return sendEmail({ to: emailAddr, ...tpl });\n    }\n    case 'WEBHOOK': {\n      const url = (channel.config as any).url;\n      const secret = (channel.config as any).secret;\n      if (!url) return false;\n      const payload: WebhookPayload = { event: type, data, timestamp: new Date().toISOString() };\n      return sendWebhook(url, payload, secret);\n    }\n    case 'SLACK': {\n      const webhookUrl = (channel.config as any).webhookUrl;\n      if (!webhookUrl) return false;\n      const msg = type.startsWith('monitor.')\n        ? formatMonitorAlert(data.monitor, type === 'monitor.down', data.check?.message || '')\n        : formatIncidentUpdate(data.incident, data.update?.message);\n      return sendSlack(webhookUrl, msg);\n    }\n    default:\n      console.warn(`[dispatcher] Unknown channel type: ${channel.type}`);\n      return false;\n  }\n}\n\nexport async function dispatchNotification(orgId: string, event: NotificationEvent): Promise<void> {\n  try {\n    // 1. Dispatch to org notification channels\n    const channels = await prisma.notificationChannel.findMany({\n      where: { orgId, enabled: true },\n    });\n\n    const results = await Promise.allSettled(\n      channels.map(async (ch: any) => {\n        const ok = await dispatchToChannel(ch, event);\n        if (!ok) {\n          // Retry once after 5s\n          await delay(5000);\n          return dispatchToChannel(ch, event);\n        }\n        return true;\n      }),\n    );\n\n    const failed = results.filter((r: any) => r.status === 'rejected' || (r.status === 'fulfilled' && !r.value));\n    if (failed.length) {\n      console.warn(`[dispatcher] ${failed.length}/${channels.length} channel(s) failed for ${event.type}`);\n    }\n\n    // 2. Notify email subscribers for incident events\n    if (event.type === 'incident.created' || event.type === 'incident.updated') {\n      const subscribers = await prisma.subscriber.findMany({\n        where: { orgId, confirmed: true, type: 'EMAIL' },\n      });\n\n      let tpl: { subject: string; html: string; text: string };\n      if (event.type === 'incident.created') {\n        tpl = templates.incidentCreated(event.data.incident, [], event.data.update?.message || '');\n      } else {\n        tpl = templates.incidentUpdated(event.data.incident, event.data.update?.message || '');\n      }\n\n      await Promise.allSettled(\n        subscribers.map(async (sub: any) => {\n          if (!sub.email) return;\n          const ok = await sendEmail({ to: sub.email, ...tpl });\n          if (!ok) {\n            await delay(5000);\n            await sendEmail({ to: sub.email, ...tpl });\n          }\n        }),\n      );\n    }\n  } catch (err) {\n    console.error('[dispatcher] Unexpected error:', err);\n  }\n}\n","import nodemailer from 'nodemailer';\n\nexport interface EmailPayload {\n  to: string;\n  subject: string;\n  html: string;\n  text?: string;\n}\n\nlet transporter: nodemailer.Transporter | null = null;\n\nfunction getTransporter(): nodemailer.Transporter {\n  if (!transporter) {\n    transporter = nodemailer.createTransport({\n      host: process.env.SMTP_HOST || 'localhost',\n      port: parseInt(process.env.SMTP_PORT || '587', 10),\n      secure: process.env.SMTP_PORT === '465',\n      auth: process.env.SMTP_USER\n        ? { user: process.env.SMTP_USER, pass: process.env.SMTP_PASS }\n        : undefined,\n    });\n  }\n  return transporter;\n}\n\nexport async function sendEmail(payload: EmailPayload): Promise<boolean> {\n  try {\n    const transport = getTransporter();\n    await transport.sendMail({\n      from: process.env.SMTP_FROM || 'noreply@statuspage.local',\n      to: payload.to,\n      subject: payload.subject,\n      html: payload.html,\n      text: payload.text,\n    });\n    return true;\n  } catch (err) {\n    console.error('[email] Failed to send:', err);\n    return false;\n  }\n}\n\n/** Allow overriding the transporter (for testing) */\nexport function setTransporter(t: nodemailer.Transporter | null): void {\n  transporter = t;\n}\n","import crypto from 'node:crypto';\n\nexport interface WebhookPayload {\n  event: string;\n  data: any;\n  timestamp: string;\n}\n\nexport async function sendWebhook(url: string, payload: WebhookPayload, secret?: string): Promise<boolean> {\n  try {\n    const body = JSON.stringify(payload);\n    const headers: Record<string, string> = { 'Content-Type': 'application/json' };\n\n    if (secret) {\n      const signature = crypto.createHmac('sha256', secret).update(body).digest('hex');\n      headers['X-Signature'] = signature;\n    }\n\n    const controller = new AbortController();\n    const timeout = setTimeout(() => controller.abort(), 10_000);\n\n    const res = await fetch(url, {\n      method: 'POST',\n      headers,\n      body,\n      signal: controller.signal,\n    });\n    clearTimeout(timeout);\n\n    if (!res.ok) {\n      console.error(`[webhook] ${url} returned ${res.status}`);\n      return false;\n    }\n    return true;\n  } catch (err) {\n    console.error('[webhook] Failed to send:', err);\n    return false;\n  }\n}\n","export interface SlackMessage {\n  text: string;\n  blocks?: SlackBlock[];\n  attachments?: SlackAttachment[];\n}\n\ninterface SlackBlock {\n  type: string;\n  text?: { type: string; text: string; emoji?: boolean };\n  fields?: { type: string; text: string }[];\n  elements?: any[];\n}\n\ninterface SlackAttachment {\n  color: string;\n  blocks?: SlackBlock[];\n}\n\nconst COLORS = { down: '#e74c3c', recovery: '#27ae60', degraded: '#f39c12', info: '#3498db' };\n\nexport function formatMonitorAlert(monitor: { name: string; url?: string }, isDown: boolean, detail: string): SlackMessage {\n  const color = isDown ? COLORS.down : COLORS.recovery;\n  const emoji = isDown ? 'ðŸ”´' : 'âœ…';\n  const status = isDown ? 'DOWN' : 'RECOVERED';\n  return {\n    text: `${emoji} ${monitor.name} is ${status}`,\n    attachments: [{\n      color,\n      blocks: [\n        { type: 'section', text: { type: 'mrkdwn', text: `*${emoji} ${monitor.name}* is *${status}*` } },\n        { type: 'section', fields: [\n          { type: 'mrkdwn', text: `*Monitor:*\\n${monitor.name}` },\n          { type: 'mrkdwn', text: `*URL:*\\n${monitor.url || 'N/A'}` },\n          { type: 'mrkdwn', text: `*Detail:*\\n${detail}` },\n        ]},\n      ],\n    }],\n  };\n}\n\nexport function formatIncidentUpdate(incident: { title: string; status: string; severity: string }, updateText?: string): SlackMessage {\n  const color = incident.severity === 'CRITICAL' ? COLORS.down : incident.severity === 'MAJOR' ? COLORS.degraded : COLORS.info;\n  return {\n    text: `âš ï¸ Incident: ${incident.title}`,\n    attachments: [{\n      color,\n      blocks: [\n        { type: 'section', text: { type: 'mrkdwn', text: `*âš ï¸ ${incident.title}*` } },\n        { type: 'section', fields: [\n          { type: 'mrkdwn', text: `*Status:*\\n${incident.status}` },\n          { type: 'mrkdwn', text: `*Severity:*\\n${incident.severity}` },\n        ]},\n        ...(updateText ? [{ type: 'section', text: { type: 'mrkdwn', text: updateText } }] : []),\n      ],\n    }],\n  };\n}\n\nexport async function sendSlack(webhookUrl: string, message: SlackMessage): Promise<boolean> {\n  try {\n    const controller = new AbortController();\n    const timeout = setTimeout(() => controller.abort(), 10_000);\n    const res = await fetch(webhookUrl, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(message),\n      signal: controller.signal,\n    });\n    clearTimeout(timeout);\n    if (!res.ok) {\n      console.error(`[slack] Webhook returned ${res.status}`);\n      return false;\n    }\n    return true;\n  } catch (err) {\n    console.error('[slack] Failed to send:', err);\n    return false;\n  }\n}\n","function wrap(title: string, body: string): string {\n  return `<!DOCTYPE html>\n<html><head><meta charset=\"utf-8\"><title>${title}</title>\n<style>body{font-family:sans-serif;color:#333;max-width:600px;margin:0 auto;padding:20px}\n.header{background:#1a1a2e;color:#fff;padding:16px 24px;border-radius:8px 8px 0 0}\n.content{background:#f8f9fa;padding:24px;border:1px solid #e0e0e0;border-radius:0 0 8px 8px}\n.badge{display:inline-block;padding:4px 12px;border-radius:12px;font-size:12px;font-weight:600;color:#fff}\n.badge-red{background:#e74c3c}.badge-green{background:#27ae60}.badge-yellow{background:#f39c12}.badge-blue{background:#3498db}\n.footer{margin-top:24px;font-size:12px;color:#999;text-align:center}\n</style></head><body>\n<div class=\"header\"><h2 style=\"margin:0\">${title}</h2></div>\n<div class=\"content\">${body}</div>\n<div class=\"footer\">Sent by Status Page Monitor</div>\n</body></html>`;\n}\n\nexport function monitorDownAlert(monitor: { name: string; url?: string }, error: string, timestamp: string): { subject: string; html: string; text: string } {\n  const subject = `ðŸ”´ Monitor Down: ${monitor.name}`;\n  const html = wrap('Monitor Down', `\n    <p><span class=\"badge badge-red\">DOWN</span></p>\n    <p><strong>${monitor.name}</strong> is not responding.</p>\n    ${monitor.url ? `<p>URL: <code>${monitor.url}</code></p>` : ''}\n    <p>Error: ${error}</p>\n    <p>Time: ${timestamp}</p>\n  `);\n  const text = `Monitor Down: ${monitor.name}\\n${monitor.url || ''}\\nError: ${error}\\nTime: ${timestamp}`;\n  return { subject, html, text };\n}\n\nexport function monitorRecoveryAlert(monitor: { name: string; url?: string }, downtimeDuration: string): { subject: string; html: string; text: string } {\n  const subject = `âœ… Monitor Recovered: ${monitor.name}`;\n  const html = wrap('Monitor Recovered', `\n    <p><span class=\"badge badge-green\">UP</span></p>\n    <p><strong>${monitor.name}</strong> is back online.</p>\n    ${monitor.url ? `<p>URL: <code>${monitor.url}</code></p>` : ''}\n    <p>Downtime: ${downtimeDuration}</p>\n  `);\n  const text = `Monitor Recovered: ${monitor.name}\\n${monitor.url || ''}\\nDowntime: ${downtimeDuration}`;\n  return { subject, html, text };\n}\n\nexport function incidentCreated(incident: { title: string; severity: string }, components: string[], initialUpdate: string): { subject: string; html: string; text: string } {\n  const subject = `âš ï¸ Incident: ${incident.title}`;\n  const badgeClass = incident.severity === 'CRITICAL' ? 'badge-red' : incident.severity === 'MAJOR' ? 'badge-yellow' : 'badge-blue';\n  const html = wrap('New Incident', `\n    <p><span class=\"badge ${badgeClass}\">${incident.severity}</span></p>\n    <h3>${incident.title}</h3>\n    ${components.length ? `<p>Affected: ${components.join(', ')}</p>` : ''}\n    <p>${initialUpdate}</p>\n  `);\n  const text = `Incident: ${incident.title}\\nSeverity: ${incident.severity}\\nAffected: ${components.join(', ')}\\n${initialUpdate}`;\n  return { subject, html, text };\n}\n\nexport function incidentUpdated(incident: { title: string; status: string }, updateText: string): { subject: string; html: string; text: string } {\n  const subject = `ðŸ“‹ Incident Update: ${incident.title}`;\n  const html = wrap('Incident Update', `\n    <p><strong>Status:</strong> ${incident.status}</p>\n    <h3>${incident.title}</h3>\n    <p>${updateText}</p>\n  `);\n  const text = `Incident Update: ${incident.title}\\nStatus: ${incident.status}\\n${updateText}`;\n  return { subject, html, text };\n}\n\nexport function subscriptionConfirmation(confirmUrl: string): { subject: string; html: string; text: string } {\n  const subject = 'Confirm your status page subscription';\n  const html = wrap('Confirm Subscription', `\n    <p>Please confirm your subscription by clicking the link below:</p>\n    <p><a href=\"${confirmUrl}\" style=\"background:#3498db;color:#fff;padding:10px 20px;border-radius:4px;text-decoration:none;display:inline-block\">Confirm Subscription</a></p>\n    <p style=\"font-size:12px;color:#999\">If you didn't request this, ignore this email.</p>\n  `);\n  const text = `Confirm your subscription: ${confirmUrl}`;\n  return { subject, html, text };\n}\n\nexport function unsubscribeConfirmation(): { subject: string; html: string; text: string } {\n  const subject = 'You have been unsubscribed';\n  const html = wrap('Unsubscribed', `\n    <p>You have been successfully unsubscribed from status page notifications.</p>\n  `);\n  const text = 'You have been successfully unsubscribed from status page notifications.';\n  return { subject, html, text };\n}\n","import { sseManager } from '../sse/manager.js';\nimport { dispatchNotification } from './dispatcher.js';\n\nexport async function onMonitorStatusChange(monitor: any, check: any, alert: any): Promise<void> {\n  sseManager.broadcastAll(monitor.orgId, {\n    type: 'monitor.status',\n    data: { monitor, check },\n  });\n\n  if (alert) {\n    await dispatchNotification(monitor.orgId, {\n      type: alert.type === 'DOWN' ? 'monitor.down' : 'monitor.recovery',\n      data: { monitor, check, alert },\n    });\n  }\n}\n\nexport async function onIncidentChange(orgId: string, incident: any, update?: any): Promise<void> {\n  sseManager.broadcastAll(orgId, {\n    type: 'incident.updated',\n    data: { incident, update },\n  });\n\n  await dispatchNotification(orgId, {\n    type: update ? 'incident.updated' : 'incident.created',\n    data: { incident, update },\n  });\n}\n\nexport async function onComponentChange(orgId: string, component: any): Promise<void> {\n  sseManager.broadcastAll(orgId, {\n    type: 'component.status',\n    data: component,\n  });\n}\n","import { z } from 'zod';\n\nexport const CreateIncidentSchema = z.object({\n  title: z.string().min(1).max(500),\n  status: z.enum(['INVESTIGATING', 'IDENTIFIED', 'MONITORING', 'RESOLVED']).optional(),\n  severity: z.enum(['MINOR', 'MAJOR', 'CRITICAL']).optional(),\n  message: z.string().min(1),\n  componentIds: z.array(z.string().uuid()).optional(),\n  componentStatus: z.enum(['OPERATIONAL', 'DEGRADED_PERFORMANCE', 'PARTIAL_OUTAGE', 'MAJOR_OUTAGE', 'UNDER_MAINTENANCE']).optional(),\n});\n\nexport const UpdateIncidentSchema = z.object({\n  title: z.string().min(1).max(500).optional(),\n  status: z.enum(['INVESTIGATING', 'IDENTIFIED', 'MONITORING', 'RESOLVED']).optional(),\n  severity: z.enum(['MINOR', 'MAJOR', 'CRITICAL']).optional(),\n});\n\nexport const AddIncidentUpdateSchema = z.object({\n  status: z.enum(['INVESTIGATING', 'IDENTIFIED', 'MONITORING', 'RESOLVED']),\n  message: z.string().min(1),\n});\n","import { Router, Request, Response, NextFunction } from 'express';\nimport * as subscriberService from '../services/subscriberService.js';\nimport { authenticate } from '../middleware/auth.js';\nimport { validate } from '../middleware/validate.js';\nimport { validatePagination } from '../middleware/pagination.js';\nimport { SubscribeSchema } from '../validation/subscribers.js';\n\nconst router = Router();\n\nfunction asyncHandler(fn: (req: Request, res: Response) => Promise<void>) {\n  return (req: Request, res: Response, next: NextFunction) => fn(req, res).catch(next);\n}\n\n// Public endpoints\nrouter.post('/:orgSlug/subscribe', validate(SubscribeSchema), asyncHandler(async (req, res) => {\n  // Need to resolve orgSlug to orgId\n  const { default: prisma } = await import('../lib/prisma.js');\n  const org = await prisma.organization.findUnique({ where: { slug: req.params.orgSlug } });\n  if (!org) { res.status(404).json({ error: { code: 'RESOURCE_NOT_FOUND', message: 'Organization not found' } }); return; }\n  const result = await subscriberService.subscribe(req.body.email, org.id, req.body.type);\n  res.status(201).json(result);\n}));\n\nrouter.get('/confirm/:token', asyncHandler(async (req, res) => {\n  const result = await subscriberService.confirm(req.params.token);\n  res.json(result);\n}));\n\nrouter.get('/unsubscribe/:token', asyncHandler(async (req, res) => {\n  const result = await subscriberService.unsubscribe(req.params.token);\n  res.json(result);\n}));\n\n// Admin endpoints (auth required)\nrouter.get('/', authenticate, validatePagination, asyncHandler(async (req, res) => {\n  const { page, limit } = req.query;\n  const result = await subscriberService.list(req.user!.orgId, {\n    page: page ? Number(page) : undefined,\n    limit: limit ? Number(limit) : undefined,\n  });\n  res.json(result);\n}));\n\nrouter.delete('/:id', authenticate, asyncHandler(async (req, res) => {\n  const result = await subscriberService.remove(req.params.id, req.user!.orgId);\n  res.json(result);\n}));\n\nexport default router;\n","import prisma from '../lib/prisma.js';\n\nclass NotFoundError extends Error {\n  statusCode = 404;\n  code = 'RESOURCE_NOT_FOUND';\n}\n\nfunction validatePagination(page?: number, limit?: number): { page: number; limit: number } {\n  let p = page || 1;\n  let l = limit || 20;\n  if (isNaN(p) || p < 1) p = 1;\n  if (isNaN(l) || l < 1) l = 1;\n  if (l > 100) l = 100;\n  return { page: p, limit: l };\n}\n\nexport async function list(orgId: string, pagination: { page?: number; limit?: number } = {}) {\n  const { page, limit } = validatePagination(pagination.page, pagination.limit);\n  const [subscribers, total] = await Promise.all([\n    prisma.subscriber.findMany({\n      where: { orgId },\n      skip: (page - 1) * limit,\n      take: limit,\n      orderBy: { createdAt: 'desc' },\n      select: { id: true, email: true, confirmed: true, orgId: true, createdAt: true, updatedAt: true },\n    }),\n    prisma.subscriber.count({ where: { orgId } }),\n  ]);\n  return { data: subscribers, meta: { total, page, limit } };\n}\n\nexport async function subscribe(email: string, orgId: string, type: string = 'EMAIL') {\n  const existing = await prisma.subscriber.findFirst({ where: { email, orgId } });\n  if (existing) return { data: { id: existing.id, email: existing.email, confirmed: existing.confirmed, message: 'Already subscribed' } };\n  const subscriber = await prisma.subscriber.create({ data: { email, orgId, type: type as any } });\n  // TODO: send confirmation email with subscriber.token\n  return { data: { id: subscriber.id, email: subscriber.email, confirmed: subscriber.confirmed, message: 'Confirmation email sent' } };\n}\n\nexport async function confirm(token: string) {\n  const subscriber = await prisma.subscriber.findUnique({ where: { token } });\n  if (!subscriber) throw new NotFoundError('Invalid confirmation token');\n  const updated = await prisma.subscriber.update({ where: { token }, data: { confirmed: true } });\n  return { data: updated };\n}\n\nexport async function unsubscribe(token: string) {\n  const subscriber = await prisma.subscriber.findUnique({ where: { token } });\n  if (!subscriber) throw new NotFoundError('Invalid unsubscribe token');\n  await prisma.subscriber.delete({ where: { token } });\n  return { data: { success: true } };\n}\n\nexport async function remove(id: string, orgId: string) {\n  const s = await prisma.subscriber.findFirst({ where: { id, orgId } });\n  if (!s) throw new NotFoundError('Subscriber not found');\n  await prisma.subscriber.delete({ where: { id } });\n  return { data: { id } };\n}\n","import { z } from 'zod';\n\nexport const SubscribeSchema = z.object({\n  email: z.string().email(),\n  type: z.enum(['EMAIL', 'WEBHOOK', 'SLACK']).optional().default('EMAIL'),\n  componentIds: z.array(z.string().uuid()).optional(),\n});\n","import { Router, Request, Response, NextFunction } from 'express';\nimport * as channelService from '../services/notificationChannelService.js';\nimport { validate } from '../middleware/validate.js';\nimport { CreateNotificationChannelSchema, UpdateNotificationChannelSchema } from '../validation/notificationChannels.js';\n\nconst router = Router();\n\nfunction asyncHandler(fn: (req: Request, res: Response) => Promise<void>) {\n  return (req: Request, res: Response, next: NextFunction) => fn(req, res).catch(next);\n}\n\nrouter.get('/', asyncHandler(async (req, res) => {\n  const result = await channelService.list(req.user!.orgId);\n  res.json(result);\n}));\n\nrouter.get('/:id', asyncHandler(async (req, res) => {\n  const result = await channelService.getById(req.params.id, req.user!.orgId);\n  res.json(result);\n}));\n\nrouter.post('/', validate(CreateNotificationChannelSchema), asyncHandler(async (req, res) => {\n  const result = await channelService.create(req.body, req.user!.orgId);\n  res.status(201).json(result);\n}));\n\nrouter.patch('/:id', validate(UpdateNotificationChannelSchema), asyncHandler(async (req, res) => {\n  const result = await channelService.update(req.params.id, req.body, req.user!.orgId);\n  res.json(result);\n}));\n\nrouter.delete('/:id', asyncHandler(async (req, res) => {\n  const result = await channelService.remove(req.params.id, req.user!.orgId);\n  res.json(result);\n}));\n\nrouter.post('/:id/test', asyncHandler(async (req, res) => {\n  const result = await channelService.test(req.params.id, req.user!.orgId);\n  res.json(result);\n}));\n\nexport default router;\n","import prisma from '../lib/prisma.js';\n\nclass NotFoundError extends Error {\n  statusCode = 404;\n  code = 'RESOURCE_NOT_FOUND';\n}\n\nexport async function list(orgId: string) {\n  const channels = await prisma.notificationChannel.findMany({ where: { orgId }, orderBy: { createdAt: 'desc' } });\n  return { data: channels };\n}\n\nexport async function create(data: any, orgId: string) {\n  const channel = await prisma.notificationChannel.create({ data: { ...data, orgId } });\n  return { data: channel };\n}\n\nexport async function getById(id: string, orgId: string) {\n  const c = await prisma.notificationChannel.findFirst({ where: { id, orgId } });\n  if (!c) throw new NotFoundError('Notification channel not found');\n  return { data: c };\n}\n\nexport async function update(id: string, data: any, orgId: string) {\n  const c = await prisma.notificationChannel.findFirst({ where: { id, orgId } });\n  if (!c) throw new NotFoundError('Notification channel not found');\n  const channel = await prisma.notificationChannel.update({ where: { id }, data });\n  return { data: channel };\n}\n\nexport async function remove(id: string, orgId: string) {\n  const c = await prisma.notificationChannel.findFirst({ where: { id, orgId } });\n  if (!c) throw new NotFoundError('Notification channel not found');\n  await prisma.notificationChannel.delete({ where: { id } });\n  return { data: { id } };\n}\n\nexport async function test(id: string, orgId: string) {\n  const c = await prisma.notificationChannel.findFirst({ where: { id, orgId } });\n  if (!c) throw new NotFoundError('Notification channel not found');\n  // In production, this would send a test notification\n  return { data: { success: true, message: 'Test notification sent' } };\n}\n","import { z } from 'zod';\n\nconst SlackConfigSchema = z.object({\n  webhookUrl: z.string().url().refine(url => url.startsWith('https://'), { message: 'Webhook URL must use HTTPS' }),\n});\n\nconst WebhookConfigSchema = z.object({\n  url: z.string().url().refine(url => url.startsWith('https://') || url.startsWith('http://'), { message: 'URL must use HTTP or HTTPS' })\n    .refine(url => !url.startsWith('javascript:'), { message: 'Invalid URL scheme' }),\n});\n\nconst EmailConfigSchema = z.object({\n  addresses: z.array(z.string().email()).min(1, 'At least one email address is required'),\n});\n\nconst SmsConfigSchema = z.object({\n  phoneNumbers: z.array(z.string().min(1)).min(1, 'At least one phone number is required'),\n});\n\nexport const CreateNotificationChannelSchema = z.object({\n  name: z.string().min(1).max(255),\n  type: z.enum(['EMAIL', 'SLACK', 'WEBHOOK', 'SMS']),\n  config: z.record(z.string(), z.unknown()),\n  enabled: z.boolean().optional(),\n}).superRefine((data, ctx) => {\n  let result;\n  switch (data.type) {\n    case 'SLACK':\n      result = SlackConfigSchema.safeParse(data.config);\n      break;\n    case 'WEBHOOK':\n      result = WebhookConfigSchema.safeParse(data.config);\n      break;\n    case 'EMAIL':\n      result = EmailConfigSchema.safeParse(data.config);\n      break;\n    case 'SMS':\n      result = SmsConfigSchema.safeParse(data.config);\n      break;\n  }\n  if (result && !result.success) {\n    for (const issue of result.error.issues) {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        path: ['config', ...issue.path],\n        message: issue.message,\n      });\n    }\n  }\n});\n\nexport const UpdateNotificationChannelSchema = CreateNotificationChannelSchema.partial();\n","import { Router, Request, Response, NextFunction } from 'express';\nimport * as apiKeyService from '../services/apiKeyService.js';\nimport { validate } from '../middleware/validate.js';\nimport { CreateApiKeySchema } from '../validation/apiKeys.js';\n\nconst router = Router();\n\nfunction asyncHandler(fn: (req: Request, res: Response) => Promise<void>) {\n  return (req: Request, res: Response, next: NextFunction) => fn(req, res).catch(next);\n}\n\n// Only OWNER and ADMIN can manage API keys\nfunction requireAdmin(req: Request, res: Response, next: NextFunction): void {\n  if (!req.user || !['OWNER', 'ADMIN'].includes(req.user.role)) {\n    res.status(403).json({ error: { code: 'FORBIDDEN', message: 'Only OWNER and ADMIN can manage API keys' } });\n    return;\n  }\n  next();\n}\n\nrouter.use(requireAdmin);\n\nrouter.get('/', asyncHandler(async (req, res) => {\n  const result = await apiKeyService.list(req.user!.orgId);\n  res.json(result);\n}));\n\nrouter.post('/', validate(CreateApiKeySchema), asyncHandler(async (req, res) => {\n  const result = await apiKeyService.create(req.body, req.user!.orgId);\n  res.status(201).json(result);\n}));\n\nrouter.delete('/:id', asyncHandler(async (req, res) => {\n  const result = await apiKeyService.revoke(req.params.id, req.user!.orgId);\n  res.json(result);\n}));\n\nexport default router;\n","import prisma from '../lib/prisma.js';\nimport crypto from 'crypto';\n\nclass NotFoundError extends Error {\n  statusCode = 404;\n  code = 'RESOURCE_NOT_FOUND';\n}\n\nexport async function list(orgId: string) {\n  const keys = await prisma.apiKey.findMany({\n    where: { orgId },\n    orderBy: { createdAt: 'desc' },\n    select: { id: true, name: true, key: true, expiresAt: true, lastUsedAt: true, createdAt: true },\n  });\n  // Mask keys - show only last 8 chars\n  const masked = keys.map((k: any) => ({ ...k, key: '...' + k.key.slice(-8) }));\n  return { data: masked };\n}\n\nexport async function create(data: { name: string; expiresAt?: string }, orgId: string) {\n  const key = `sp_${crypto.randomBytes(32).toString('hex')}`;\n  const apiKey = await prisma.apiKey.create({\n    data: { name: data.name, key, orgId, expiresAt: data.expiresAt ? new Date(data.expiresAt) : null },\n  });\n  return { data: apiKey }; // Return full key only on creation\n}\n\nexport async function revoke(id: string, orgId: string) {\n  const k = await prisma.apiKey.findFirst({ where: { id, orgId } });\n  if (!k) throw new NotFoundError('API key not found');\n  await prisma.apiKey.delete({ where: { id } });\n  return { data: { id } };\n}\n","import { z } from 'zod';\n\nexport const CreateApiKeySchema = z.object({\n  name: z.string().min(1).max(255),\n  expiresAt: z.string().datetime().optional().refine(\n    (val) => {\n      if (!val) return true;\n      return new Date(val) > new Date();\n    },\n    { message: 'Expiration date must be in the future' }\n  ),\n});\n","import { Router, Request, Response, NextFunction } from 'express';\nimport * as statusPageService from '../services/statusPageService.js';\nimport { authenticate } from '../middleware/auth.js';\nimport { validate } from '../middleware/validate.js';\nimport { UpdateStatusPageConfigSchema } from '../validation/statusPage.js';\n\nconst router = Router();\n\nfunction asyncHandler(fn: (req: Request, res: Response) => Promise<void>) {\n  return (req: Request, res: Response, next: NextFunction) => fn(req, res).catch(next);\n}\n\n// Admin endpoints\nrouter.get('/config', authenticate, asyncHandler(async (req, res) => {\n  const result = await statusPageService.getConfig(req.user!.orgId);\n  res.json(result);\n}));\n\nrouter.patch('/config', authenticate, validate(UpdateStatusPageConfigSchema), asyncHandler(async (req, res) => {\n  const result = await statusPageService.updateConfig(req.user!.orgId, req.body);\n  res.json(result);\n}));\n\nexport default router;\n","import prisma from '../lib/prisma.js';\nimport { MonitorStatus } from '@prisma/client';\n\nclass NotFoundError extends Error {\n  statusCode = 404;\n  code = 'RESOURCE_NOT_FOUND';\n}\n\nexport async function getConfig(orgId: string) {\n  const config = await prisma.statusPageConfig.findUnique({ where: { orgId } });\n  return { data: config };\n}\n\nexport async function updateConfig(orgId: string, data: any) {\n  const config = await prisma.statusPageConfig.upsert({\n    where: { orgId },\n    update: data,\n    create: { ...data, orgId, title: data.title || 'Status Page' },\n  });\n  return { data: config };\n}\n\nasync function getOrgBySlug(slug: string) {\n  const org = await prisma.organization.findUnique({ where: { slug } });\n  if (!org) throw new NotFoundError('Status page not found');\n  return org;\n}\n\nexport async function getPublicStatus(slug: string) {\n  const org = await getOrgBySlug(slug);\n  const [config, components, groups] = await Promise.all([\n    prisma.statusPageConfig.findUnique({ where: { orgId: org.id } }),\n    prisma.component.findMany({ where: { orgId: org.id, showOnStatusPage: true }, orderBy: { order: 'asc' }, include: { group: true } }),\n    prisma.componentGroup.findMany({ where: { orgId: org.id }, orderBy: { order: 'asc' } }),\n  ]);\n\n  const allOperational = components.every((c: any) => c.status === 'OPERATIONAL');\n  const hasMajor = components.some((c: any) => c.status === 'MAJOR_OUTAGE');\n  const overallStatus = hasMajor ? 'major_outage' : allOperational ? 'operational' : 'degraded';\n\n  return {\n    data: {\n      name: org.name,\n      config,\n      overallStatus,\n      components,\n      groups,\n    },\n  };\n}\n\nexport async function getPublicIncidents(slug: string) {\n  const org = await getOrgBySlug(slug);\n  const incidents = await prisma.incident.findMany({\n    where: { orgId: org.id },\n    orderBy: { createdAt: 'desc' },\n    take: 50,\n    include: { updates: { orderBy: { createdAt: 'desc' } }, components: { include: { component: true } } },\n  });\n  return { data: incidents };\n}\n\nexport async function getPublicUptime(slug: string, days: number = 90) {\n  const org = await getOrgBySlug(slug);\n  const components = await prisma.component.findMany({ where: { orgId: org.id, showOnStatusPage: true }, orderBy: { order: 'asc' } });\n  const since = new Date(Date.now() - days * 86400000);\n\n  const uptimeData = await Promise.all(\n    components.map(async (component: any) => {\n      const monitors = await prisma.monitor.findMany({ where: { componentId: component.id } });\n      if (monitors.length === 0) return { componentId: component.id, name: component.name, uptime: null, noData: true };\n      const monitorIds = monitors.map((m: any) => m.id);\n      const [total, up] = await Promise.all([\n        prisma.monitorCheck.count({ where: { monitorId: { in: monitorIds }, checkedAt: { gte: since } } }),\n        prisma.monitorCheck.count({ where: { monitorId: { in: monitorIds }, checkedAt: { gte: since }, status: MonitorStatus.UP } }),\n      ]);\n      return { componentId: component.id, name: component.name, uptime: total > 0 ? Math.round((up / total) * 10000) / 100 : 100 };\n    })\n  );\n  return { data: uptimeData };\n}\n\nexport async function getPublicMetrics(slug: string) {\n  const org = await getOrgBySlug(slug);\n  const monitors = await prisma.monitor.findMany({ where: { orgId: org.id, enabled: true }, include: { component: true } });\n  const since = new Date(Date.now() - 86400000);\n\n  const metrics = await Promise.all(\n    monitors.map(async (monitor: any) => {\n      const checks = await prisma.monitorCheck.findMany({\n        where: { monitorId: monitor.id, checkedAt: { gte: since }, responseTime: { not: null } },\n        select: { checkedAt: true, responseTime: true },\n        orderBy: { checkedAt: 'asc' },\n      });\n      return { monitorId: monitor.id, name: monitor.name, component: monitor.component?.name, data: checks };\n    })\n  );\n  return { data: metrics };\n}\n","import { z } from 'zod';\n\nexport const UpdateStatusPageConfigSchema = z.object({\n  title: z.string().min(1).max(255).optional(),\n  description: z.string().optional(),\n  logoUrl: z.string().url().optional().nullable(),\n  faviconUrl: z.string().url().optional().nullable(),\n  customDomain: z.string().optional().nullable(),\n  customCss: z.string().max(50000, 'Custom CSS must be under 50KB').optional().nullable(),\n  showUptime: z.boolean().optional(),\n  showResponseTime: z.boolean().optional(),\n});\n","import { Router, Request, Response, NextFunction } from 'express';\nimport * as statusPageService from '../services/statusPageService.js';\n\nconst router = Router();\n\nfunction asyncHandler(fn: (req: Request, res: Response) => Promise<void>) {\n  return (req: Request, res: Response, next: NextFunction) => fn(req, res).catch(next);\n}\n\nrouter.get('/:slug/status', asyncHandler(async (req, res) => {\n  const result = await statusPageService.getPublicStatus(req.params.slug);\n  res.json(result);\n}));\n\nrouter.get('/:slug/incidents', asyncHandler(async (req, res) => {\n  const result = await statusPageService.getPublicIncidents(req.params.slug);\n  res.json(result);\n}));\n\nrouter.get('/:slug/uptime', asyncHandler(async (req, res) => {\n  let days = req.query.days ? Number(req.query.days) : 90;\n  if (isNaN(days) || days < 1) days = 1;\n  if (days > 365) days = 365;\n  const result = await statusPageService.getPublicUptime(req.params.slug, days);\n  res.json(result);\n}));\n\nrouter.get('/:slug/metrics', asyncHandler(async (req, res) => {\n  const result = await statusPageService.getPublicMetrics(req.params.slug);\n  res.json(result);\n}));\n\nexport default router;\n","import { Router, type Request, type Response } from 'express';\nimport { authenticate } from '../middleware/auth.js';\nimport prisma from '../lib/prisma.js';\nimport { sseManager } from './manager.js';\n\nconst router = Router();\n\nfunction setupSSE(res: Response): NodeJS.Timeout {\n  res.writeHead(200, {\n    'Content-Type': 'text/event-stream',\n    'Cache-Control': 'no-cache',\n    'Connection': 'keep-alive',\n    'X-Accel-Buffering': 'no',\n  });\n  res.write(':ok\\n\\n');\n\n  // Heartbeat every 30s\n  const heartbeat = setInterval(() => {\n    try { res.write(':ping\\n\\n'); } catch { /* connection closed */ }\n  }, 30_000);\n\n  return heartbeat;\n}\n\n// Dashboard SSE â€” requires auth\nrouter.get('/api/sse/dashboard', authenticate, (req: Request, res: Response) => {\n  const orgId = req.user!.orgId;\n  const heartbeat = setupSSE(res);\n\n  sseManager.addConnection(orgId, 'dashboard', res);\n\n  req.on('close', () => {\n    clearInterval(heartbeat);\n    sseManager.removeConnection(orgId, 'dashboard', res);\n  });\n});\n\n// Public SSE â€” no auth, by org slug\nrouter.get('/api/public/:slug/sse', async (req: Request, res: Response) => {\n  const org = await prisma.organization.findUnique({ where: { slug: req.params.slug } });\n  if (!org) {\n    res.status(404).json({ error: 'Not found' });\n    return;\n  }\n\n  const heartbeat = setupSSE(res);\n  sseManager.addConnection(org.id, 'public', res);\n\n  req.on('close', () => {\n    clearInterval(heartbeat);\n    sseManager.removeConnection(org.id, 'public', res);\n  });\n});\n\nexport default router;\n","import { Router, Request, Response } from 'express';\n\nexport function createHeartbeatRouter(prisma: any): Router {\n  const router = Router();\n\n  async function handleHeartbeat(req: Request, res: Response) {\n    const { token } = req.params;\n\n    try {\n      const monitor = await prisma.monitor.findUnique({\n        where: { heartbeatToken: token },\n      });\n\n      if (!monitor) {\n        return res.status(404).json({ error: 'Monitor not found' });\n      }\n\n      if (monitor.type !== 'HEARTBEAT') {\n        return res.status(400).json({ error: 'Monitor is not a heartbeat type' });\n      }\n\n      const now = new Date();\n\n      // Update lastCheckedAt\n      await prisma.monitor.update({\n        where: { id: monitor.id },\n        data: { lastCheckedAt: now, currentStatus: 'UP' },\n      });\n\n      // Record an UP check\n      await prisma.monitorCheck.create({\n        data: {\n          monitorId: monitor.id,\n          status: 'UP',\n          responseTime: 0,\n          region: 'heartbeat',\n        },\n      });\n\n      return res.json({ ok: true, msg: 'Heartbeat recorded' });\n    } catch (err: any) {\n      console.error('[Heartbeat] Error:', err);\n      return res.status(500).json({ error: 'Internal server error' });\n    }\n  }\n\n  router.post('/:token', handleHeartbeat);\n  router.get('/:token', handleHeartbeat);\n\n  return router;\n}\n","import { Request, Response, NextFunction } from 'express';\n\nexport function errorHandler(err: any, _req: Request, res: Response, _next: NextFunction): void {\n  console.error(err);\n\n  // Handle Prisma known request errors (FK violations, unique constraints, etc.)\n  if (err?.constructor?.name === 'PrismaClientKnownRequestError' || err?.code?.startsWith?.('P')) {\n    if (err.code === 'P2003') {\n      res.status(422).json({ error: 'Referenced resource not found' });\n      return;\n    }\n    if (err.code === 'P2002') {\n      const target = err.meta?.target;\n      res.status(409).json({ error: `Unique constraint violation${target ? ` on ${target}` : ''}` });\n      return;\n    }\n    if (err.code === 'P2025') {\n      res.status(404).json({ error: 'Resource not found' });\n      return;\n    }\n  }\n\n  // Handle Prisma validation errors (invalid enum values, etc.)\n  if (err?.constructor?.name === 'PrismaClientValidationError') {\n    res.status(400).json({ error: 'Invalid request data' });\n    return;\n  }\n\n  res.status(500).json({\n    error: 'Internal server error',\n    ...(process.env.NODE_ENV === 'development' ? { message: err.message } : {}),\n  });\n}\n","import { Request, Response, NextFunction } from 'express';\nimport xss from 'xss';\n\nfunction sanitizeValue(value: unknown): unknown {\n  if (typeof value === 'string') {\n    return xss(value);\n  }\n  if (Array.isArray(value)) {\n    return value.map(sanitizeValue);\n  }\n  if (value && typeof value === 'object') {\n    return sanitizeObject(value as Record<string, unknown>);\n  }\n  return value;\n}\n\nfunction sanitizeObject(obj: Record<string, unknown>): Record<string, unknown> {\n  const result: Record<string, unknown> = {};\n  for (const [key, val] of Object.entries(obj)) {\n    result[key] = sanitizeValue(val);\n  }\n  return result;\n}\n\nexport function sanitizeBody(req: Request, _res: Response, next: NextFunction): void {\n  if (req.body && typeof req.body === 'object') {\n    req.body = sanitizeObject(req.body);\n  }\n  next();\n}\n"],"mappings":"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","names":["import_express","import_jsonwebtoken","import_zod","jwt","rateLimit","jwt","bcrypt","import_express","import_client","key","validatePagination","import_zod","router","validatePagination","import_express","NotFoundError","list","create","getById","update","remove","import_zod","router","asyncHandler","list","getById","create","update","remove","import_express","NotFoundError","list","create","getById","update","remove","router","asyncHandler","list","getById","create","update","remove","import_express","nodemailer","crypto","update","NotFoundError","validatePagination","list","getById","create","update","remove","import_zod","router","asyncHandler","validatePagination","list","getById","create","update","remove","import_express","NotFoundError","validatePagination","list","remove","import_zod","router","asyncHandler","prisma","validatePagination","list","remove","import_express","NotFoundError","list","create","getById","update","remove","import_zod","router","asyncHandler","list","getById","create","update","remove","import_express","NotFoundError","list","create","key","crypto","import_zod","router","asyncHandler","list","create","import_express","import_client","NotFoundError","import_zod","router","asyncHandler","import_express","router","asyncHandler","import_express","router","import_express","prisma","router","xss","key","express","cors","path"]}